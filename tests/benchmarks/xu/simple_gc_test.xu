// Simple GC memory test
var BENCH_SCALE = "500000"

func test_gc_memory() {
    var N = parse_int(BENCH_SCALE)
    print("Testing GC with " + to_text(N) + " items...")
    
    print("Initial RSS: " + to_text(process_rss()))
    
    // Create a large dictionary
    let d = {}
    var i = 0
    while i < N {
        d.insert("k" + to_text(i), i)
        i = i + 1
    }
    
    print("After creation: " + to_text(process_rss()))
    
    // Clear reference && run GC
    let _ = d
    gc()
    
    print("After GC: " + to_text(process_rss()))
}

func main() {
    test_gc_memory()
}