var bench_scale = "1000"

func now_us() -> int { return mono_micros() }

func bench_loop(N: int) -> int {
  var start = now_us()
  var c = 0
  for t in [1..N] { c += 1 }
  var end = now_us()
  return parse_int((end - start + 500.0) / 1000.0)
}

func bench_dict(N: int) -> int {
  var start = now_us()
  let d = {}
  for j in [0..N-1] {
    let k = "k" + to_text(j)
    d.insert(k, j)
  }
  let _len = d.length()
  var end = now_us()
  return parse_int((end - start + 500.0) / 1000.0)
}

func main() {
  var N = parse_int(bench_scale)
  var v = bench_loop(N)
  let b1 = builder_new()
  builder_push(b1, "\{")
  builder_push(b1, "\"case\":\"loop\",\"scale\":")
  builder_push(b1, N)
  builder_push(b1, ",\"duration_ms\":")
  builder_push(b1, v)
  builder_push(b1, "\}")
  let s1 = builder_finalize(b1)
  print(s1)
  v = bench_dict(N)
  let b2 = builder_new()
  builder_push(b2, "\{")
  builder_push(b2, "\"case\":\"dict\",\"scale\":")
  builder_push(b2, N)
  builder_push(b2, ",\"duration_ms\":")
  builder_push(b2, v)
  builder_push(b2, "\}")
  let s2 = builder_finalize(b2)
  print(s2)
}
