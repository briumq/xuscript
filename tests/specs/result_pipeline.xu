func assert(x) { __builtin_assert(x) }

func ok_or_err(ok: bool) {
    if ok { return Result#ok(3) }
    return Result#err("boom")
}

let r1 = ok_or_err(true).map(|x: int| x + 1)
assert(match r1 { Result#ok(v) { v } _ { 0 } } == 4)

let r2 = ok_or_err(false).map_err(|e: string| "E:{e}")
assert(match r2 { Result#err(msg) { msg } _ { "" } } == "E:boom")

let r3 = ok_or_err(true).then(|x: int| Result#ok(x * 2))
assert(match r3 { Result#ok(v) { v } _ { 0 } } == 6)
