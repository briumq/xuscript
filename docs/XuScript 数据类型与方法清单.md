# XuScript 数据类型与方法清单

本文档详细列出了 XuScript 中支持的数据类型及其内置方法，并与其他主流脚本语言进行对比分析。

## 与主流脚本语言的对比

### 对比维度

| 数据类型 | XuScript 支持度 | 主流语言 (Python/JavaScript/Ruby) 特性 | 差距分析 |
|---------|----------------|--------------------------------------|----------|
| 整数 (int) | 基础支持 | 丰富的数学运算、进制转换、位操作等 | 缺少数学运算和进制转换方法 |
| 浮点数 (float) | 基础支持 | 数学运算、精度控制、科学计数法等 | 缺少数学运算和精度控制方法 |
| 字符串 (string) | 良好支持 | 正则表达式、编码处理、高级格式化等 | 缺少正则表达式支持 |
| 列表 (list) | 基础支持 | 排序、高阶函数、更灵活的操作等 | 缺少排序和高阶函数支持 |
| 字典 (dict) | 基础支持 | 删除操作、默认值机制、合并策略等 | 缺少删除操作和默认值机制 |
| 元组 (tuple) | 基础支持 | 不可变、解包、索引访问、迭代等 | 缺少解包和不可变性保证 |
| 文件 (file) | 极简支持 | 写入操作、行读取、文件指针操作等 | 缺少写入和高级读取操作 |
| 其他类型 | 部分支持 | 集合、符号、范围、正则表达式等 | 缺少多种高级数据类型 |

## 实现状态说明

- ✅ 已实现：功能已完全实现并可用
- ⏳ 计划中：功能已规划但尚未实现
- ❌ 未实现：功能尚未规划或优先级较低

## 简单数据类型

### 1. 整数 (int)

| 方法名 | 描述 | 参数 | 返回值 | 实现状态 |
|--------|------|------|--------|----------|
| `to_string()` | 将整数转换为字符串 | 无 | 字符串 | ✅ 已实现 |
| `abs()` | 获取绝对值 | 无 | 整数 | ✅ 已实现 |
| `to_base()` | 转换为指定进制 | 进制 (int) | 字符串 | ✅ 已实现 |
| `is_even()` | 检查是否为偶数 | 无 | 布尔值 | ✅ 已实现 |
| `is_odd()` | 检查是否为奇数 | 无 | 布尔值 | ✅ 已实现 |

### 2. 浮点数 (float)

| 方法名 | 描述 | 参数 | 返回值 | 实现状态 |
|--------|------|------|--------|----------|
| `to_string()` | 将浮点数转换为字符串 | 无 | 字符串 | ✅ 已实现 |
| `to_int()` | 将浮点数转换为整数（截断小数部分） | 无 | 整数 | ✅ 已实现 |
| `abs()` | 获取绝对值 | 无 | 浮点数 | ✅ 已实现 |
| `round()` | 四舍五入 | 小数位数 (int) | 浮点数 | ✅ 已实现 |
| `floor()` | 向下取整 | 无 | 浮点数 | ✅ 已实现 |
| `ceil()` | 向上取整 | 无 | 浮点数 | ✅ 已实现 |

### 3. 字符串 (string)

| 方法名 | 描述 | 参数 | 返回值 | 实现状态 |
|--------|------|------|--------|----------|
| `format()` | 格式化字符串 | 字典 | 格式化后的字符串 | ✅ 已实现 |
| `split()` | 按分隔符分割字符串 | 分隔符 | 字符串列表 | ✅ 已实现 |
| `to_int()` | 将字符串转换为整数 | 无 | 整数 | ✅ 已实现 |
| `to_float()` | 将字符串转换为浮点数 | 无 | 浮点数 | ✅ 已实现 |
| `try_to_int()` | 尝试将字符串转换为整数 | 无 | Option[整数] | ✅ 已实现 |
| `try_to_float()` | 尝试将字符串转换为浮点数 | 无 | Option[浮点数] | ✅ 已实现 |
| `replace()` | 替换字符串中的子串 | 旧子串, 新子串 | 替换后的字符串 | ✅ 已实现 |
| `trim()` | 去除字符串首尾空白 | 无 | 去除空白后的字符串 | ✅ 已实现 |
| `to_upper()` | 将字符串转换为大写 | 无 | 大写字符串 | ✅ 已实现 |
| `to_lower()` | 将字符串转换为小写 | 无 | 小写字符串 | ✅ 已实现 |
| `starts_with()` | 检查字符串是否以指定前缀开头 | 前缀 | 布尔值 | ✅ 已实现 |
| `ends_with()` | 检查字符串是否以指定后缀结尾 | 后缀 | 布尔值 | ✅ 已实现 |
| `len()` / `length()` | 获取字符串长度 | 无 | 整数 | ✅ 已实现 |
| `find()` | 查找子串位置 | 子串 | Option[int] | ✅ 已实现 |
| `substr()` | 提取子串 | 起始位置, 长度 | 字符串 | ✅ 已实现 |
| `match()` | 正则表达式匹配 | 正则表达式 | Option[列表] | ✅ 已实现 |
| `replace_all()` | 替换所有匹配子串 | 旧子串, 新子串 | 字符串 | ✅ 已实现 |
| `trim_start()` | 去除字符串开头空白 | 无 | 字符串 | ✅ 已实现 |
| `trim_end()` | 去除字符串结尾空白 | 无 | 字符串 | ✅ 已实现 |

### 4. 布尔值 (bool)

| 方法名 | 描述 | 参数 | 返回值 | 实现状态 |
|--------|------|------|--------|----------|
| `to_string()` | 将布尔值转换为字符串 | 无 | 字符串 | ✅ 已实现 |
| `not()` | 逻辑非操作 | 无 | 布尔值 | ✅ 已实现 |

## 复合数据类型

### 1. 列表 (list)

| 方法名 | 描述 | 参数 | 返回值 | 实现状态 |
|--------|------|------|--------|----------|
| `push()` | 向列表追加元素 | 元素 | 修改后的列表 | ✅ 已实现 |
| `pop()` | 移除并返回最后一个元素 | 无 | 被移除的元素 | ✅ 已实现 |
| `reverse()` | 反转列表 | 无 | 反转后的列表 | ✅ 已实现 |
| `join()` | 用指定分隔符连接列表元素 | 分隔符 | 连接后的字符串 | ✅ 已实现 |
| `length()` | 获取列表长度 | 无 | 整数 | ✅ 已实现 |
| `contains()` | 检查列表是否包含指定元素 | 元素 | 布尔值 | ✅ 已实现 |
| `clear()` | 清空列表 | 无 | 空列表 | ✅ 已实现 |
| `remove()` | 按索引删除元素并返回该元素 | 索引 | 被移除的元素 | ✅ 已实现 |
| `insert()` | 在指定位置插入元素 | 索引, 元素 | 修改后的列表 | ✅ 已实现 |
| `sort()` | 对列表排序 | 无 | 排序后的列表 | ✅ 已实现 |
| `map()` | 对列表元素应用函数 | 函数 | 新列表 | ✅ 已实现 |
| `filter()` | 过滤列表元素 | 谓词函数 | 新列表 | ✅ 已实现 |
| `reduce()` | 归约列表元素 | 函数, 初始值 | 归约结果 | ✅ 已实现 |
| `find()` | 查找第一个匹配元素 | 谓词函数 | Option[元素] | ✅ 已实现 |

### 2. 字典 (dict)

| 方法名 | 描述 | 参数 | 返回值 | 实现状态 |
|--------|------|------|--------|----------|
| `merge()` | 合并另一个字典 | 字典 | 合并后的字典 | ✅ 已实现 |
| `insert()` | 插入键值对 | 键, 值 | 修改后的字典 | ✅ 已实现 |
| `get()` | 获取指定键的值 | 键 | Option[值] | ✅ 已实现 |
| `keys()` | 获取所有键 | 无 | 键列表 | ✅ 已实现 |
| `values()` | 获取所有值 | 无 | 值列表 | ✅ 已实现 |
| `remove()` | 删除指定键的键值对 | 键 | Option[值] | ✅ 已实现 |
| `get_or_default()` | 获取指定键的值，若不存在则返回默认值 | 键, 默认值 | 值 | ✅ 已实现 |
| `items()` | 获取所有键值对 | 无 | 键值对列表 | ✅ 已实现 |
| `clear()` | 清空字典 | 无 | 空字典 | ✅ 已实现 |

### 3. 元组 (tuple)

| 特性 | 描述 | 实现状态 |
|------|------|----------|
| 元组创建 | 使用括号创建元组，如 `(1, "hello", 3.14)` | ✅ 已实现 |
| 索引访问 | 通过整数索引访问元组元素，如 `tuple[0]` | ✅ 已实现 |
| 长度获取 | 获取元组的长度 | ✅ 已实现 |
| 迭代支持 | 支持在 foreach 循环中迭代元组元素 | ✅ 已实现 |
| 不可变性 | 元组内容不可修改 | ⏳ 计划中 |
| 解包操作 | 支持元组解包到多个变量 | ❌ 未实现 |

### 4. 文件 (file)

| 方法名 | 描述 | 参数 | 返回值 | 实现状态 |
|--------|------|------|--------|----------|
| `read()` | 读取文件内容 | 无 | 字符串 | ✅ 已实现 |
| `close()` | 关闭文件 | 无 | 无 | ✅ 已实现 |
| `write()` | 写入内容到文件 | 内容 | 无 | ❌ 未实现 |
| `append()` | 追加内容到文件 | 内容 | 无 | ❌ 未实现 |
| `read_lines()` | 按行读取文件内容 | 无 | 字符串列表 | ❌ 未实现 |
| `seek()` | 设置文件指针位置 | 偏移量, 起始位置 | 无 | ❌ 未实现 |

### 5. 选项 (Option)

| 方法名 | 描述 | 参数 | 返回值 | 实现状态 |
|--------|------|------|--------|----------|
| `or()` | 如果是 None，则返回指定值 | 默认值 | 值 | ✅ 已实现 |
| `or_else()` | 如果是 None，则执行指定函数并返回其结果 | 函数 | 值 | ✅ 已实现 |
| `map()` | 对内部值应用函数并返回新的 Option | 函数 | Option[函数返回值] | ✅ 已实现 |
| `then()` | 对内部值应用函数并返回其结果 | 函数 | 函数返回值 | ✅ 已实现 |
| `each()` | 对内部值执行副作用函数 | 函数 | 无 | ✅ 已实现 |
| `filter()` | 根据条件过滤内部值 | 谓词函数 | Option[值] | ✅ 已实现 |
| `has()` | 检查是否为 Some | 无 | 布尔值 | ✅ 已实现 |
| `none()` | 检查是否为 None | 无 | 布尔值 | ✅ 已实现 |

### 6. 枚举 (enum)

| 特性 | 描述 | 实现状态 |
|------|------|----------|
| 基本枚举定义 | 使用 `with` 关键字定义枚举类型 | ✅ 已实现 |
| 方法绑定 | 使用 `does` 关键字绑定自定义方法 | ✅ 已实现 |
| 实例方法 | 支持定义和调用实例方法 | ✅ 已实现 |
| 静态方法 | 支持定义和调用静态方法 | ✅ 已实现 |
| 带数据的枚举 | 支持包含数据的枚举变体 | ❌ 未实现 |

### 7. 结构体 (struct)

| 特性 | 描述 | 实现状态 |
|------|------|----------|
| 基本结构体定义 | 使用 `has` 关键字定义结构体类型 | ✅ 已实现 |
| 方法绑定 | 使用 `does` 关键字绑定自定义方法 | ✅ 已实现 |
| 实例方法 | 支持定义和调用实例方法 | ✅ 已实现 |
| 静态方法 | 支持定义和调用静态方法 | ✅ 已实现 |
| 构造函数 | 支持自定义构造函数 | ✅ 已实现 |
| 继承 | 支持结构体继承 | ❌ 未实现 |

## 缺失功能总结

### 1. 数学运算与类型转换
- 整数和浮点数的数学运算方法已实现（如 `abs()`, `round()`, `floor()`, `ceil()` 等）
- 进制转换方法已实现（如 `to_base()`）

### 2. 字符串处理
- 缺少正则表达式支持
- 缺少正则表达式相关操作（如 `match()` 等）

### 3. 列表操作
- 缺少排序功能
- 缺少高阶函数支持（如 `map()`, `filter()`, `reduce()` 等）
- 缺少更灵活的插入操作

### 4. 字典操作
- 缺少删除操作
- 缺少默认值机制
- 缺少键值对遍历功能

### 5. 文件操作
- 缺少写入操作
- 缺少行读取和文件指针操作

### 6. 高级数据类型
- 缺少集合类型
- 缺少符号类型
- 缺少范围类型
- 缺少正则表达式类型

### 7. 其他功能
- 布尔值的基本方法已实现（如 `to_string()` 和 `not()` 等）
- 枚举缺少带数据的变体支持
- 结构体缺少继承支持

## 方法绑定语法

### 为枚举类型绑定方法

```xu
Status with [ pending | approved | rejected ]

Status does {
    func to_string() -> string {
        if self == Status#pending {
            return "pending"
        } else if self == Status#approved {
            return "approved"
        } else {
            return "rejected"
        }
    }
    
    func is_approved() -> bool {
        return self == Status#approved
    }
}
```

### 为结构体类型绑定方法

```xu
User has {
    name: string
    age: int
}

User does {
    func greet() {
        println("Hello, {self.name}!")
    }
    
    func is_adult() -> bool {
        return self.age >= 18
    }
    
    static func create(name: string, age: int = 0) -> User {
        return User{ name: name, age: age }
    }
}
```

## 注意事项

1. 方法调用语法：`object.method(args)`
2. 部分方法有别名，如 `len()` 和 `length()` 功能相同
3. 枚举和结构体类型支持使用 `does` 关键字绑定自定义方法
4. 方法调用时，方法名会被转换为对应的 `MethodKind` 枚举值，然后根据接收对象的类型分发到具体的实现函数

## 示例

### 字符串方法示例

```xu
let s = "Hello, World!"
println(s.to_upper())  // 输出: HELLO, WORLD!
println(s.split(", ")) // 输出: ["Hello", "World!"]
```

### 列表方法示例

```xu
let numbers = [1, 2, 3]
numbers.add(4)          // 现在 numbers = [1, 2, 3, 4]
println(numbers.pop())  // 输出: 4, 现在 numbers = [1, 2, 3]
```

### 字典方法示例

```xu
let person = {"name": "Alice", "age": 30}
person.insert("city", "New York")
println(person.get("name"))  // 输出: Option.Some("Alice")
println(person.keys())        // 输出: ["name", "age", "city"]
```

### 枚举方法示例

```xu
let status = Status#approved
println(status.to_string())     // 输出: approved
println(status.is_approved())   // 输出: true
```

### 元组使用示例

```xu
// 创建元组
let person = ("Alice", 30, "New York")

// 索引访问
println(person[0])  // 输出: Alice
println(person[1])  // 输出: 30
println(person[2])  // 输出: New York

// 迭代元组
foreach item in person {
    println(item)
}
// 输出:
// Alice
// 30
// New York
```

### 结构体方法示例

```xu
let user = User.create("Bob", 25)
user.greet()                   // 输出: Hello, Bob!
println(user.is_adult())       // 输出: true
```

## 方法名建议

以下是对当前拥有多个方法名的功能的命名建议，基于主流脚本语言的命名习惯：

| 功能 | 当前方法名 | 主流语言命名 | 建议保留 | 理由 |
|------|------------|--------------|----------|------|
| 字符串前缀检查 | `starts_with()` / `starts()` | Python: `startswith()`, JavaScript: `startsWith()`, Ruby: `start_with?()` | `starts_with()` | 与 JavaScript 命名一致，语义更清晰 |
| 字符串后缀检查 | `ends_with()` / `ends()` | Python: `endswith()`, JavaScript: `endsWith()`, Ruby: `end_with?()` | `ends_with()` | 与 JavaScript 命名一致，语义更清晰 |
| 长度获取 | `len()` / `length()` | Python: `len()` (函数), JavaScript: `length` (属性), Ruby: `length()` | `length()` | 方法形式更符合面向对象风格，与 Ruby 一致 |
| 列表添加元素 | `add()` / `push()` | Python: `append()`, JavaScript: `push()`, Ruby: `push()` | `push()` | 与 JavaScript 和 Ruby 命名一致，更常用 |

### 建议理由

1. **语义清晰度**：选择语义更清晰、更具描述性的方法名，如 `starts_with()` 比 `starts()` 更明确表达了功能。

2. **跨语言一致性**：优先选择与主流语言（尤其是 JavaScript）一致的命名，降低学习成本。

3. **面向对象风格**：选择符合面向对象风格的命名，如使用方法形式 `length()` 而非函数形式 `len()`。

4. **常用性**：选择更常用的命名，如 `push()` 比 `add()` 在其他语言中更常见。

5. **一致性**：保持方法命名的一致性，如所有布尔返回值的方法不使用问号结尾（与当前风格一致）。